<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project Dashboard</title>
    <script src="https://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
    <script src="https://code.highcharts.com/modules/treemap.js"></script>
    <script src="https://code.highcharts.com/modules/exporting.js"></script>
    <script src="https://code.highcharts.com/modules/accessibility.js"></script>
    <link rel="stylesheet" href="/static/styles.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap');

        /* General Styling */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            scroll-behavior: smooth;
        }

        body {
            background: linear-gradient(135deg, #A569BD, #D2B4DE);
            color: black;
            padding: 20px;
            text-align: center;
        }

        h2 {
            font-size: 36px;
            color: #2E1A47;
            margin-bottom: 20px;
            text-shadow: 0px 3px 8px rgba(142, 68, 173, 0.6);
        }

        /* Dashboard Container */
        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            padding: 20px;
            max-width: 1600px;
            margin: 0 auto;
        }

        .chart-box {
            width: 100%;
            height: 400px;
            background: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            box-shadow: 0px 10px 50px rgba(142, 68, 173, 0.4);
            padding: 20px;
            transition: all 0.3s ease-in-out;
        }

        .chart-box:hover {
            transform: translateY(-5px);
            box-shadow: 0px 15px 60px rgba(142, 68, 173, 0.6);
        }

        /* Home Button */
        .home-button {
            display: inline-block;
            margin-top: 20px;
            padding: 12px 20px;
            font-size: 18px;
            color: white;
            background: #8E44AD;
            border: none;
            border-radius: 8px;
            text-decoration: none;
            transition: 0.3s;
        }

        .home-button:hover {
            background: #6C3483;
            transform: scale(1.05);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            font-size: 14px;
            color: white;
            background: rgba(142, 68, 173, 0.5);
            width: 100%;
            position: fixed;
            bottom: 0;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }

            h2 {
                font-size: 28px;
            }
        }
    </style>
</head>
<body>

    <h2>Project Dashboard</h2>

    <div class="dashboard-container">
        <div id="chart1" class="chart-box"></div>
        <div id="chart2" class="chart-box"></div>
        <div id="chart3" class="chart-box"></div>
        <div id="chart4" class="chart-box"></div>
        <div id="chart5" class="chart-box"></div>
        <div id="chart6" class="chart-box"></div>
        <div id="chart7" class="chart-box"></div>
        <div id="chart8" class="chart-box"></div>
        <div id="chart9" class="chart-box"></div>
        <div id="chart10" class="chart-box"></div>
    </div>

    <!-- Home Button -->
    <a href="{{ url_for('home') }}" class="home-button">Go to Home</a>

    <div class="footer">
        Â© 2025 ASSURE-CSR | Designed for Impact |
        <a href="{{ url_for('home') }}" style="color: white; text-decoration: underline;">Go to Home</a>
    </div>

    <script>
        // Auto redirect to home after 5 seconds
        setTimeout(() => {
            window.location.href = "{{ url_for('home') }}";
        }, 5000);

        // Survey data passed from Flask
        const surveyData = {{ survey_data | tojson | safe }};

        // Function to generate random colors for charts
        const getRandomColor = () => {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        };

        // Function to extract data for charts
        const extractChartData = (data, project) => {
            const projectData = data.filter(item => item.project === project);
            if (!projectData.length) return null;

            // Aggregate data for all entries of the same project
            const metrics = {};
            projectData.forEach(entry => {
                Object.entries(entry).forEach(([key, value]) => {
                    if (key !== 'project' && typeof value === 'number') {
                        if (!metrics[key]) metrics[key] = 0;
                        metrics[key] += value;
                    }
                });
            });

            return Object.entries(metrics).map(([name, y]) => ({ name, y }));
        };

        // Chart configurations
        const chartConfigs = [
            { type: 'column', title: 'Training Metrics', project: 'education' },
            { type: 'line', title: 'Progress Over Time', project: 'healthcare' },
            { type: 'bar', title: 'Performance Comparison', project: 'environment' },
            { type: 'pie', title: 'Task Distribution', project: 'welfare' },
            { type: 'area', title: 'Engagement Growth', project: 'rural' },
            { type: 'scatter', title: 'Score Distribution', project: 'disaster' },
            { type: 'heatmap', title: 'User Activity', project: 'education' },
            { type: 'treemap', title: 'Resource Allocation', project: 'healthcare' },
            { type: 'column', title: 'Income Growth', project: 'rural' },
            { type: 'pie', title: 'Disease Reduction', project: 'healthcare' }
        ];

        // Render charts
        chartConfigs.forEach((config, index) => {
            const chartData = extractChartData(surveyData, config.project);

            Highcharts.chart(`chart${index + 1}`, {
                chart: { type: config.type },
                title: { text: `${config.title} - ${config.project}` },
                series: [{ name: config.project, data: chartData || [{ name: 'Metric 1', y: 10 }] }]
            });
        });
    </script>

</body>
</html>
